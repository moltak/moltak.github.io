<!DOCTYPE html><html lang="en"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon-dark.svg" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/svg+xml" href="/favicon-light.svg" media="(prefers-color-scheme: light)"><link rel="icon" type="image/x-icon" href="/favicon-light.svg"><meta name="generator" content="Astro v5.17.1"><!-- Font preloads --><link rel="preload" href="/_astro/inter-latin-400-normal.C38fXH4l.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/_astro/inter-latin-600-normal.LgqL8muc.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/_astro/lora-latin-400-normal.DnxXpLNu.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="/_astro/lora-latin-600-normal.B-3RcLOQ.woff2" as="font" type="font/woff2" crossorigin><!-- Canonical URL --><link rel="canonical" href="https://moltak.github.io/blog/17-spring-cacheable/"><!-- Primary Meta Tags --><title>@Cacheable 헤메지 않고 사용하기 | Kh Jung</title><meta name="title" content="@Cacheable 헤메지 않고 사용하기 | Kh Jung"><meta name="description" content="Spring @Cacheable + Redis 적용 가이드 — Jackson ObjectMapper 설정과 삽질 기록"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://moltak.github.io/blog/17-spring-cacheable/"><meta property="og:title" content="@Cacheable 헤메지 않고 사용하기 | Kh Jung"><meta property="og:description" content="Spring @Cacheable + Redis 적용 가이드 — Jackson ObjectMapper 설정과 삽질 기록"><meta property="og:image" content="https://moltak.github.io/nano.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://moltak.github.io/blog/17-spring-cacheable/"><meta property="twitter:title" content="@Cacheable 헤메지 않고 사용하기 | Kh Jung"><meta property="twitter:description" content="Spring @Cacheable + Redis 적용 가이드 — Jackson ObjectMapper 설정과 삽질 기록"><meta property="twitter:image" content="https://moltak.github.io/nano.png"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><!-- RSS Link --><link rel="alternate" type="application/rss+xml" title="Kh Jung" href="https://moltak.github.io/rss.xml"><script type="module">document.addEventListener("astro:before-swap",e=>[...e.newDocument.head.querySelectorAll('link[as="font"]')].forEach(o=>o.remove()));</script><script>
  function init() {
    preloadTheme();
    onScroll();
    animate();

    const backToTop = document.getElementById("back-to-top");
    backToTop?.addEventListener("click", (event) => scrollToTop(event));

    const backToPrev = document.getElementById("back-to-prev");
    backToPrev?.addEventListener("click", () => window.history.back());

    const lightThemeButton = document.getElementById("light-theme-button");
    lightThemeButton?.addEventListener("click", () => {
      localStorage.setItem("theme", "light");
      toggleTheme(false);
    });

    const darkThemeButton = document.getElementById("dark-theme-button");
    darkThemeButton?.addEventListener("click", () => {
      localStorage.setItem("theme", "dark");
      toggleTheme(true);
    });

    const systemThemeButton = document.getElementById("system-theme-button");
    systemThemeButton?.addEventListener("click", () => {
      localStorage.setItem("theme", "system");
      toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches);
    });

    window.matchMedia("(prefers-color-scheme: dark)")
      .addEventListener("change", event => {
        if (localStorage.theme === "system" || !localStorage.theme) {
          toggleTheme(event.matches);
        }
      }
    );

    document.addEventListener("scroll", onScroll);
  }

  function animate() {
    const animateElements = document.querySelectorAll(".animate");

    animateElements.forEach((element, index) => {
      setTimeout(() => {
        element.classList.add("show");
      }, index * 150);
    });
  }

  function onScroll() {
    if (window.scrollY > 0) {
      document.documentElement.classList.add("scrolled");
    } else {
      document.documentElement.classList.remove("scrolled");
    }
  }

  function scrollToTop(event) {
    event.preventDefault();
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  }

function toggleTheme(dark) {
    const css = document.createElement("style");

    css.appendChild(
      document.createTextNode(
        `* {
             -webkit-transition: none !important;
             -moz-transition: none !important;
             -o-transition: none !important;
             -ms-transition: none !important;
             transition: none !important;
          }
        `,
      )
    );

    document.head.appendChild(css);

    if (dark) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }

  window.getComputedStyle(css).opacity;
    document.head.removeChild(css);
  }

  function preloadTheme() {
    const userTheme = localStorage.theme;

    if (userTheme === "light" || userTheme === "dark") {
      toggleTheme(userTheme === "dark");
    } else {
      toggleTheme(window.matchMedia("(prefers-color-scheme: dark)").matches);
    }
  }

  document.addEventListener("DOMContentLoaded", () => init());
  document.addEventListener("astro:after-swap", () => init());
  preloadTheme();
</script><link rel="stylesheet" href="/_astro/_slug_.DDcn1B-x.css"></head> <body> <header> <div class="mx-auto max-w-screen-lg px-5">  <div class="flex flex-wrap gap-y-2 justify-between"> <a href="/" target="_self" class="inline-block decoration-black/15 dark:decoration-white/30 hover:decoration-black/25 hover:dark:decoration-white/50 text-current hover:text-black hover:dark:text-white transition-colors duration-300 ease-in-out">  <div class="font-semibold"> Kh Jung </div>  </a> </div>  </div> </header> <main>  <div class="mx-auto max-w-screen-lg px-5">  <div class="animate flex items-center justify-between"> <a href="/blog" class="relative group w-fit flex pl-7 pr-3 py-1.5 flex-nowrap rounded border border-black/15 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/5 hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="absolute top-1/2 left-2 -translate-y-1/2 size-4 stroke-2 fill-none stroke-current"> <line x1="5" y1="12" x2="19" y2="12" class="translate-x-2 group-hover:translate-x-0 scale-x-0 group-hover:scale-x-100 transition-transform duration-300 ease-in-out"></line> <polyline points="12 5 5 12 12 19" class="translate-x-1 group-hover:translate-x-0 transition-transform duration-300 ease-in-out"></polyline> </svg> <div class="text-sm"> 
Back to blog
 </div> </a> <a href="/blog/72-java-monitoring" class="group flex items-center gap-1.5 pl-3 pr-3 py-1.5 rounded border border-black/15 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/5 hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out text-sm"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="size-4 fill-none stroke-current stroke-2 group-hover:rotate-180 transition-transform duration-300 ease-in-out"> <rect x="4" y="4" width="16" height="16" rx="2"></rect> <circle cx="9" cy="9" r="1.2" fill="currentColor" stroke="none"></circle> <circle cx="12" cy="12" r="1.2" fill="currentColor" stroke="none"></circle> <circle cx="15" cy="15" r="1.2" fill="currentColor" stroke="none"></circle> </svg>
Random
</a> </div> <div class="space-y-1 my-10"> <div class="animate flex items-center gap-1.5"> <div class="font-base text-sm"> <time datetime="2025-08-08T15:00:00.000Z"> Aug 9, 2025 </time> </div>
&bull;
<div class="font-base text-sm"> 5 min read </div> </div> <div class="animate text-2xl font-semibold text-black dark:text-white"> @Cacheable 헤메지 않고 사용하기 </div> </div> <div class="relative"> <article class="animate"> <h2 id="개요">개요</h2>
<p>이 문서를 작성하는 이유는 Cache를 추가하며 삽질했던 경험을 바탕으로 동료들이 같은 문제를 빠르게 회피하기 위함이다. 필요한 부분에선 step by step으로 구성했고 어떤 부분에선 두서에 상관없이 적었기 때문에 목차를 보고 필요한 부분만 찾아보는게 좋다. 만약 처음 <code>@Cacheable</code>를 적용한다면 처음부터 보세요!</p>
<h2 id="cacheable-적용하기"><code>@Cacheable</code> 적용하기</h2>
<blockquote>
<p>redis 없이 메모리만 이용하는 방법도 있으나 우리는 사용하지 않으니 이 문서에선 따로 설명하지 않습니다.</p>
</blockquote>
<h3 id="1-redis-세팅-redisconfigjava">1. redis 세팅 (RedisConfig.java)</h3>
<p>우린 Redis Client로 <a href="https://github.com/lettuce-io/lettuce-core">lettuce</a>를 사용함. 아래와 같이 간단히 redis connection을 생성할 수 있음.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> LettuceConnectionFactory </span><span style="color:#B392F0">redisConnectionFactory</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> LettuceConnectionFactory</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> RedisStandaloneConfiguration</span><span style="color:#E1E4E8">(host, port));</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-cacheable-어노테이션">2. <code>@Cacheable</code> 어노테이션</h3>
<p>Redis connection을 설정했고 spring boot 의존성 주입 및 설정도 잘 마쳤으면 아래와 SpEL을 통해 <strong>간단하게</strong> key를 설정할 수 있다.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">GetMapping</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Cacheable</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#79B8FF">    key</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;#FIRST_ID.toString() + #SECOND_ID.toString() + (#jwt?.userId ?: &#39;temp&#39;)&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    cacheNames</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;CACHE_NAME&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">    value</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;VALUE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span></code></pre>
<p>key의 파라미터 설명</p>
<ul>
<li><code>#FIRST_ID.toString()</code> → FIRST_ID.toString() 호출. #를 붙여야 변수에 접근할 수 있다.</li>
<li><code>(#jwt?.CART_NO_KEY ?: &#39;temp&#39;)</code> SpEL의 <a href="https://docs.spring.io/spring-framework/reference/core/expressions/language-ref/operator-elvis.html">elvis operator</a>를 사용해서 jwt이 null인 경우 temp를 아닌경우 userId를 key의 일부로 사용하게 하는 변수로 사용할 수 있다.</li>
</ul>
<p><code>@Cacheable</code>에 설정한 cacheNames, value, key의 조합으로 아래와 같은 cache key가 redis에 생성된다.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">CACHE_NAME:::FIRST_IDSECOND_IDJWTUSERID</span></span></code></pre>
<h3 id="3-cacheable-동작-방식-간략히-설명">3. <code>@Cacheable</code> 동작 방식 간략히 설명</h3>
<p><code>@Cacheable</code>등의 어노테이션은 proxy로 동작한다. 스프링앱이 부트스트랩 될 때, advice/behavior가 추가되서 “외부 클래스에서 해당 함수를 호출 할 때” advice가 proxy를 실행한다.</p>
<blockquote>
<p>조금 갑작스래 언급되는 proxy는 spring boot에서 상당히 중요하다. 이걸 제대로 이해하지 못하면 어려움이 생긴다.
<a href="https://medium.com/upday-devs/3-common-mistakes-when-implementing-spring-cache-abstraction-a7ac2ee247ba">여기</a>를 참고하자</p>
</blockquote>
<p>아래 예제에서 cache가 동작하는 부분과 하지 않는 부분을 확인해보세요! (kotlin)</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#B392F0">@Component</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> StarWarsOperations</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    fun</span><span style="color:#B392F0"> destroyDeathStar</span><span style="color:#E1E4E8">(year: </span><span style="color:#B392F0">Int</span><span style="color:#E1E4E8">): </span><span style="color:#B392F0">Boolean</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.javaClass.name)</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#E1E4E8"> year </span><span style="color:#F97583">&gt;</span><span style="color:#79B8FF"> 2000</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#B392F0"> selfDestroyDeathStar</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// cache 동작 안함</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    @Cacheable</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">&quot;DeathStar&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    fun</span><span style="color:#B392F0"> selfDestroyDeathStar</span><span style="color:#E1E4E8">(): </span><span style="color:#B392F0">Boolean</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        return</span><span style="color:#79B8FF"> false</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">val</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> new </span><span style="color:#B392F0">StarWarsOperations</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">selfDestroyDeathStar</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// 외부에서 함수 호출 했으므로 cache 동작함</span></span></code></pre>
<p>(자세한 설명은 <a href="https://medium.com/upday-devs/3-common-mistakes-when-implementing-spring-cache-abstraction-a7ac2ee247ba"><strong>1. Invocation of cacheable methods from the same class</strong></a> 참고)</p>
<h2 id="어려운-점-적기">어려운 점 적기</h2>
<p><code>@Cacheable</code> 을 적용하고 테스트해보면 json deserialization 때, 아마 에러가 발생할 것이다. 특히 복잡한 데이터 형태를 갖고 있는 경우와 jdk8 LocalDateTime을 사용한 경우에는 반드시 문제를 겪게 된다. 이때 아래에 이어지는 Jackson ObjectMapper 의 옵션 내용이 도움이된다.</p>
<h3 id="jackson-objectmapper">Jackson ObjectMapper</h3>
<p>아래에 있는 ObjectMapper가 redis cache를 사용할 때, 사용하는 ObjectMapper이다. 각 옵션이 어떻게 사용되지에 대해 주석을 추가해놨으니 더 궁금한 부분은 직접 찾아보도록 하자.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Bean</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">name</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;jacksonRedisSerializer&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#E1E4E8"> RedisSerializer</span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">Object</span><span style="color:#F97583">&gt;</span><span style="color:#B392F0"> jacksonRedisSerializer</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">  val objectMapper </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> ObjectMapper</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#6A737D">      // support for detecting constructor and factory method (&quot;creator&quot;) parameters</span></span>
<span class="line"><span style="color:#6A737D">      // without having to use @JsonProperty annotation</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">registerModule</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> ParameterNamesModule</span><span style="color:#E1E4E8">(JsonCreator.Mode.DEFAULT))</span></span>
<span class="line"><span style="color:#6A737D">      // support for other new Java 8 datatypes outside of date/time:</span></span>
<span class="line"><span style="color:#6A737D">      // most notably Optional, OptionalLong, OptionalDouble</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">registerModule</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> Jdk8Module</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#6A737D">      // support for Java 8 date/time types (specified in JSR-310 specification)</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">registerModule</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">new</span><span style="color:#B392F0"> JavaTimeModule</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#6A737D">      // serialization 때, date/time을 timestamp로 변환하지 않도록</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">configure</span><span style="color:#E1E4E8">(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">      // Deserialization 때, 모르는 property가 있어도 무시하도록</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">configure</span><span style="color:#E1E4E8">(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">      // Deserialization 때, date/time을 context timezone으로 변환하지 않도록</span></span>
<span class="line"><span style="color:#E1E4E8">      .</span><span style="color:#B392F0">configure</span><span style="color:#E1E4E8">(DeserializationFeature.ADJUST_DATES_TO_CONTEXT_TIME_ZONE, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // @JsonTypeInfo가 없는 경우, 자동으로 type 정보를 추가하도록 설정</span></span>
<span class="line"><span style="color:#E1E4E8">  val objectMapperWithTyping </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> objectMapper.</span><span style="color:#B392F0">activateDefaultTyping</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">      objectMapper.</span><span style="color:#B392F0">getPolymorphicTypeValidator</span><span style="color:#E1E4E8">(),</span></span>
<span class="line"><span style="color:#6A737D">      // NON_FINAL 클래스에 type 정보를 추가하도록 설정.</span></span>
<span class="line"><span style="color:#6A737D">      // record는 final이므로 JsonTypeInfo를 명시적으로 넣어줘야함</span></span>
<span class="line"><span style="color:#E1E4E8">      ObjectMapper.DefaultTyping.NON_FINAL,</span></span>
<span class="line"><span style="color:#6A737D">      // JsonTypeInfo를 PROPERTY로 추가하도록 설정</span></span>
<span class="line"><span style="color:#E1E4E8">      JsonTypeInfo.As.PROPERTY);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> GenericJackson2JsonRedisSerializer</span><span style="color:#E1E4E8">(objectMapperWithTyping);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="jsontypeinfo-설명"><code>@JsonTypeInfo</code> 설명</h3>
<p>PageResponse는 JsonTypeInfo 어노테이션을 추가해서 타입 정보를 JSON에 포함시킴</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="java"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">Builder</span></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#F97583">JsonTypeInfo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">use</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> JsonTypeInfo.Id.CLASS, </span><span style="color:#79B8FF">property</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;@class&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> record</span><span style="color:#B392F0"> PageResponse</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">    Long id,</span></span>
<span class="line"><span style="color:#E1E4E8">    String title,</span></span>
<span class="line"><span style="color:#E1E4E8">    String description,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">With</span></span>
<span class="line"><span style="color:#E1E4E8">    @</span><span style="color:#F97583">JsonTypeInfo</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">use</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> JsonTypeInfo.Id.CLASS, </span><span style="color:#79B8FF">property</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> &quot;@class&quot;</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    List</span><span style="color:#F97583">&lt;</span><span style="color:#E1E4E8">ChapterResponse</span><span style="color:#F97583">&gt;</span><span style="color:#E1E4E8"> chapters</span></span>
<span class="line"><span style="color:#E1E4E8">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ExampleResponse가 JSON에 다음과 같이 저장됨. JSON에 포함된 “@class”를 통해 ObjectMapper는 정확한 클래스로 instance를 만들 수 있음.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;@class&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;com.example.ParentResponse&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;id&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;TEST_TITLE&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;description&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;DESCRIPTION&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  &quot;chapters&quot;</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">    &quot;java.util.ImmutableCollections$ListN&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span></span>
<span class="line"><span style="color:#E1E4E8">      {</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;@class&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;com.example.ChildResponse&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;id&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;title&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;CHILD_TITLE&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;subtitle&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;refType&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;CHILD_TYPE&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;refId&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;sequence&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        &quot;content&quot;</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">          &quot;@class&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;com.example.ThirdResponse&quot;</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">          &quot;type&quot;</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">&quot;TYPE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    ]</span></span>
<span class="line"><span style="color:#E1E4E8">  ]</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="헤맸던-부분들">헤맸던 부분들</h3>
<h4 id="could-not-read-json-cannot-construct-instance-of-javautilarraylistsublist"><code>Could not read JSON: Cannot construct instance of &#39;java.util.ArrayList$SubList&#39;</code></h4>
<p>Jackson에서 이 에러가 발생하는 경우는, JSON 데이터를 역직렬화(Deserialization) 하려고 할 때, Jackson 라이브러리가 특정 타입의 인스턴스를 생성하려고 하나, 그 과정에서 실패했을 때 발생한다.</p>
<p><code>ArrayList$SubList</code>는 <code>ArrayList</code>의 내부 클래스로, <code>ArrayList</code>의 일부분을 뷰(view)로 제공하는 용도로 사용된다. 이 클래스는 일반적으로 사용자가 명시적으로 생성하지 않으며, <code>ArrayList</code>의 <code>subList</code> 메소드를 호출할 때 내부적으로 생성된다.</p>
<p>에러 메시지는 Jackson이 <code>ArrayList$SubList</code> 타입의 객체를 생성하려고 시도했으나, 이 타입이 직접적인 인스턴스화를 지원하지 않아 실패했음을 의미한다. (자바 문법 오류)</p>
<p><strong>해결 방법:</strong></p>
<ol>
<li><strong>타입 정보 수정</strong>: 직렬화 대상이 되는 객체에서 <code>ArrayList$SubList</code> 타입을 사용하는 부분을 <code>List</code>나 <code>ArrayList</code>와 같이 직접 인스턴스화할 수 있는 타입으로 변경</li>
<li><strong>Custom Deserializer 사용</strong>: Jackson에서 제공하는 기능을 활용하여 커스텀 역직렬화 방법을 구현</li>
<li><strong>Mix-In Annotation 사용</strong>: Jackson의 Mix-In 기능을 사용하여 타깃 클래스에 대한 직렬화/역직렬화 규칙을 별도의 인터페이스나 추상 클래스에 정의</li>
</ol>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://docs.spring.io/spring-framework/reference/integration/cache.html">Spring Cache Abstraction</a></li>
<li><a href="https://docs.spring.io/spring-data/redis/reference/">Spring Data Redis</a></li>
<li><a href="https://docs.spring.io/spring-framework/reference/core/expressions/language-ref/operator-elvis.html">SpEL - Elvis Operator</a></li>
<li><a href="https://medium.com/upday-devs/3-common-mistakes-when-implementing-spring-cache-abstraction-a7ac2ee247ba">3 Common Mistakes when implementing Spring Cache Abstraction</a></li>
<li><a href="https://fasterxml.github.io/jackson-annotations/javadoc/2.4/allclasses-noframe.html">Jackson Javadoc</a></li>
<li><a href="https://www.tutorialspoint.com/jackson_annotations/index.htm">Jackson Annotation Tutorial Point</a></li>
</ul> </article> <aside class="hidden xl:block absolute top-0 bottom-0 left-full ml-10 w-56"> <nav class="sticky top-8" id="toc-nav"> <p class="text-xs font-semibold uppercase tracking-wider text-black/50 dark:text-white/50 mb-3">
On this page
</p> <ul class="space-y-1.5 text-sm border-l border-black/10 dark:border-white/10"> <li> <a href="#개요" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-3" data-slug="개요"> 개요 </a> </li><li> <a href="#cacheable-적용하기" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-3" data-slug="cacheable-적용하기"> @Cacheable 적용하기 </a> </li><li> <a href="#1-redis-세팅-redisconfigjava" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="1-redis-세팅-redisconfigjava"> 1. redis 세팅 (RedisConfig.java) </a> </li><li> <a href="#2-cacheable-어노테이션" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="2-cacheable-어노테이션"> 2. @Cacheable 어노테이션 </a> </li><li> <a href="#3-cacheable-동작-방식-간략히-설명" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="3-cacheable-동작-방식-간략히-설명"> 3. @Cacheable 동작 방식 간략히 설명 </a> </li><li> <a href="#어려운-점-적기" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-3" data-slug="어려운-점-적기"> 어려운 점 적기 </a> </li><li> <a href="#jackson-objectmapper" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="jackson-objectmapper"> Jackson ObjectMapper </a> </li><li> <a href="#jsontypeinfo-설명" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="jsontypeinfo-설명"> @JsonTypeInfo 설명 </a> </li><li> <a href="#헤맸던-부분들" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-6 text-xs" data-slug="헤맸던-부분들"> 헤맸던 부분들 </a> </li><li> <a href="#reference" class="toc-link block py-0.5 text-black/40 dark:text-white/40 hover:text-black dark:hover:text-white transition-colors duration-200 border-l-2 border-transparent -ml-px pl-3" data-slug="reference"> Reference </a> </li> </ul> </nav> </aside> </div>  </div>  </main> <footer class="animate"> <div class="mx-auto max-w-screen-lg px-5">  <div class="relative"> <div class="absolute right-0 -top-20"> <button id="back-to-top" class="relative group w-fit flex pl-8 pr-3 py-1.5 flex-nowrap rounded border border-black/15 dark:border-white/20 hover:bg-black/5 dark:hover:bg-white/5 hover:text-black dark:hover:text-white transition-colors duration-300 ease-in-out"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="absolute top-1/2 left-2 -translate-y-1/2 size-4 stroke-2 fill-none stroke-current rotate-90"> <line x1="5" y1="12" x2="19" y2="12" class="translate-x-2 group-hover:translate-x-0 scale-x-0 group-hover:scale-x-100 transition-transform duration-300 ease-in-out"></line> <polyline points="12 5 5 12 12 19" class="translate-x-1 group-hover:translate-x-0 transition-transform duration-300 ease-in-out"></polyline> </svg> <div class="text-sm">
Back to top
</div> </button> </div> </div> <div class="flex justify-between items-center"> <div>
&copy; 2026 | Kh Jung </div> <div class="flex flex-wrap gap-1 items-center"> <button id="light-theme-button" aria-label="Light theme" class="group size-8 flex items-center justify-center rounded-full"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"> <circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line> </svg> </button> <button id="dark-theme-button" aria-label="Dark theme" class="group size-8 flex items-center justify-center rounded-full"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"> <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path> </svg> </button> <button id="system-theme-button" aria-label="System theme" class="group size-8 flex items-center justify-center rounded-full"> <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"> <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect> <line x1="8" y1="21" x2="16" y2="21"></line> <line x1="12" y1="17" x2="12" y2="21"></line> </svg> </button> </div> </div>  </div> </footer> </body></html> <script type="module">function n(){const r=document.querySelectorAll(".toc-link");if(!r.length)return;const c=new IntersectionObserver(o=>{for(const t of o)if(t.isIntersecting){r.forEach(i=>{i.classList.remove("!text-black","dark:!text-white","!border-black/60","dark:!border-white/60")});const e=document.querySelector(`.toc-link[data-slug="${t.target.id}"]`);e&&e.classList.add("!text-black","dark:!text-white","!border-black/60","dark:!border-white/60")}},{rootMargin:"0px 0px -80% 0px",threshold:0});r.forEach(o=>{const t=o.dataset.slug;if(t){const e=document.getElementById(t);e&&c.observe(e)}})}n();document.addEventListener("astro:after-swap",n);</script>